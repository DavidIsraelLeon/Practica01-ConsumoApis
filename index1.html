<!DOCTYPE html>
<html>
<head>
<title>Aplicaciones</title>


<link rel ="stylesheet" type="text/css" href="css/bootstrap.min.css">
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/jquery-3.6.0.min.js"></script>


</head>

<body>

<nav class="navbar navbar-dark bg-dark"> 
    <a class="navbar-brand" href="index.html">Aplicaciones Distribuidas</a>
    <a class="navbar-brand" href="#">LISTAR TODOS</a>

    <input  type="search" id="search" placeholder="Search" autocomplete="off" aria-label="Search">
    
</nav>

<section id ="shows" class="grid-fluid">    </section>
    <template id="show-template">
            <article class="show">

            <h4  class="alert alert-dark" ></h4>
            <div></div>
            <img></img>
    </article>
    </template>

   
    <body>
        <div class ="container mt-4 shadow-lg p3 mb-5 bg-body rounded">
            <table class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>NOMBRE</th>
                            <th>EMAIL</th>
                        </tr>
                    </thead>
                    <tbody id="data">

                    </tbody>


            </table>

    </body>
    <script>
        let url ='http://api.tvmaze.com/schedule'
        fetch(url)
        .then(response=>response.json())
        .then(data=>mostrarData(data))
        .catch(error=>console.log(error))


        const mostrarData=(data)=>{
            console.log(data)
            let body=''
            for (let i=0;i<data.length;i++){
                body +=`<tr><td>${data[i].show.genres}</td><td>${data[i].show.name}</td><td>${data[i].show.url}</td></tr>`
            }
            document.getElementById('data').innerHTML=body
        }
    </script>

<script>
    const d = document,
    $shows=d.getElementById("shows"),
    $template=d.getElementById("show-template").content,
    $fragment=d.createDocumentFragment();
    d.addEventListener('keypress',async e=>{
        if(e.target.matches("#search")){
            //console.log(e.key)
            if (e.key==="Enter"){
                try {
                    let query = e.target.value.toLowerCase(),
                    api =`http://api.tvmaze.com/search/shows?q=${query}`,   
                    res= await fetch(api),
                    json=await res.json();
                    console.log(api,res,json);
                    if(!res.ok) throw {status:res.status,statusText:res.statusText};

                    if (json.length===0){
                        $shows.innerHTML=`<h3> No existe:${query}</h3>`;
                    }else {
                        json.forEach(element => {
                            $template.querySelector("h4").textContent=element.show.name;
                            $template.querySelector("div").textContent=element.show.url;    
                            $template.querySelector("img").textContent=element.show.image;               

                            let $clone=d.importNode($template,true);
                            $fragment.append($clone);
                        });
                        
                        $shows.appendChild($fragment);
                    }

                } catch (err) {
                    console.log(err);
                    let message=err.statusText||"Ocurrio error";
                    $shows.innerHTML=`<p>Error ${err.status}:${message}</p>`;                    
                }
            }
        
        }
    })
</script>
</body>
</html>
